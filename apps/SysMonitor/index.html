<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>NextOS SysMon</title>

    <style>
      /* ==================================================
        NEXTOS UI CORE (RIUTILIZZABILE)
        ================================================== */

      :root {
        --bg: #050a08;
        --panel: #081512;
        --border: #0f3;
        --text: #7dffb3;
        --dim: #3a7;
        --warn: #ffb347;

        --font: "Courier New", monospace;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        background: var(--bg);
        color: var(--text);
        font-family: var(--font);
        overflow: hidden;
      }

      /* ==================================================
        LAYOUT
        ================================================== */

      .app {
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-rows: auto 1fr auto;
      }

      /* Header */

      .header {
        padding: 12px 20px;
        border-bottom: 1px solid var(--border);
        background: var(--panel);
        display: flex;
        justify-content: space-between;
        font-size: 18px;
      }

      /* Main */

      .main {
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-auto-rows: 1fr;
        gap: 20px;
      }

      /* Footer */

      .footer {
        padding: 10px 20px;
        border-top: 1px solid var(--border);
        background: var(--panel);
        text-align: center;
        color: var(--dim);
      }

      /* ==================================================
        PANELS
        ================================================== */

      .panel {
        background: var(--panel);
        border: 1px solid var(--border);
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 10px;
        position: relative;
      }

      .panel-title {
        color: var(--warn);
        font-size: 16px;
        border-bottom: 1px solid var(--dim);
        padding-bottom: 4px;
      }

      /* ==================================================
        BARS
        ================================================== */

      .bar {
        width: 100%;
        height: 18px;
        background: #02100a;
        border: 1px solid var(--dim);
        position: relative;
      }

      .bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #0f3, #7dffb3);
        width: 0%;
        transition: width 0.3s;
      }

      /* ==================================================
        TEXT BLOCK
        ================================================== */

      .info {
        line-height: 1.6;
        font-size: 15px;
        white-space: pre;
      }

      /* Scanline effect */

      body::after {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background: repeating-linear-gradient(
          to bottom,
          rgba(0, 255, 150, 0.03),
          rgba(0, 255, 150, 0.03) 1px,
          transparent 2px,
          transparent 3px
        );
      }
    </style>
  </head>

  <body>
    <div class="app">
      <!-- HEADER -->

      <div class="header">
        <div>NextOS :: SYS.MONITOR</div>
        <div id="clock"></div>
      </div>

      <!-- MAIN -->

      <div class="main">
        <!-- MEMORY -->

        <div class="panel">
          <div class="panel-title">MEMORY</div>

          <div class="bar">
            <div id="memBar" class="bar-fill"></div>
          </div>

          <div id="memInfo" class="info"></div>
        </div>

        <!-- STORAGE -->

        <div class="panel">
          <div class="panel-title">LOCAL STORAGE</div>

          <div class="bar">
            <div id="storeBar" class="bar-fill"></div>
          </div>

          <div id="storeInfo" class="info"></div>
        </div>

        <!-- SYSTEM -->

        <div class="panel">
          <div class="panel-title">SYSTEM</div>

          <div id="sysInfo" class="info"></div>
        </div>

        <!-- RENDER -->

        <div class="panel">
          <div class="panel-title">RENDER</div>

          <div id="fpsInfo" class="info"></div>
        </div>
      </div>

      <!-- FOOTER -->

      <div class="footer">Press Q or ESC to exit</div>
    </div>

    <script>
      /* ==================================================
        UTILS
        ================================================== */

      function mb(bytes) {
        return (bytes / 1024 / 1024).toFixed(2);
      }

      /* ==================================================
        CLOCK
        ================================================== */

      function updateClock() {
        document.getElementById("clock").textContent =
          new Date().toLocaleTimeString();
      }

      setInterval(updateClock, 1000);
      updateClock();

      /* ==================================================
        FPS
        ================================================== */

      let last = performance.now();
      let frames = 0;
      let fps = 0;

      function fpsLoop(t) {
        frames++;

        if (t - last >= 1000) {
          fps = frames;
          frames = 0;
          last = t;
        }

        requestAnimationFrame(fpsLoop);
      }

      requestAnimationFrame(fpsLoop);

      /* ==================================================
        MAIN LOOP
        ================================================== */

      function update() {
        /* MEMORY */

        if (performance.memory) {
          const used = performance.memory.usedJSHeapSize;
          const total = performance.memory.jsHeapSizeLimit;

          const pct = (used / total) * 100;

          memBar.style.width = pct + "%";

          memInfo.textContent =
            "Used  : " +
            mb(used) +
            " MB\n" +
            "Limit : " +
            mb(total) +
            " MB\n" +
            "Load  : " +
            pct.toFixed(1) +
            " %";
        } else {
          memInfo.textContent = "Not supported";
        }

        /* STORAGE */

        let used = 0;

        for (let k in localStorage) {
          used += (localStorage[k].length + k.length) * 2;
        }

        const quota = navigator.storage?.estimate
          ? navigator.storage.estimate()
          : Promise.resolve(null);

        quota.then((r) => {
          if (!r) {
            storeInfo.textContent = "Not supported";
            return;
          }

          const pct = (r.usage / r.quota) * 100;

          storeBar.style.width = pct + "%";

          storeInfo.textContent =
            "Used  : " +
            mb(r.usage) +
            " MB\n" +
            "Quota : " +
            mb(r.quota) +
            " MB\n" +
            "Load  : " +
            pct.toFixed(1) +
            " %";
        });

        /* SYSTEM */

        sysInfo.textContent =
          "UserAgent : " +
          navigator.userAgent +
          "\n" +
          "Platform  : " +
          navigator.platform +
          "\n" +
          "Cores     : " +
          navigator.hardwareConcurrency +
          "\n" +
          "Memory    : " +
          (navigator.deviceMemory || "?") +
          " GB\n" +
          "Language  : " +
          navigator.language;

        /* FPS */

        fpsInfo.textContent =
          "FPS : " +
          fps +
          "\n" +
          "Time: " +
          performance.now().toFixed(0) +
          " ms";
      }

      /* ==================================================
        LOOP
        ================================================== */

      setInterval(update, 500);
      update();

      /* ==================================================
        EXIT
        ================================================== */

      document.addEventListener("keydown", (e) => {
        if (e.key === "q" || e.key === "Escape") {
          window.close();
        }
      });
    </script>
  </body>
</html>
